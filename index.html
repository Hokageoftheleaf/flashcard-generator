<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Set Flashcard Generator (Accounts)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); min-height: 100vh; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; }
        .container { max-width: 1100px; margin: 0 auto; background: #fff; border-radius: 18px; box-shadow: 0 10px 30px #0002; padding: 32px 20px; }
        h1 { text-align: center; margin-bottom: 6px; color: #2575fc; }
        .auth-box { max-width: 400px; margin: 40px auto 0 auto; background: #f8f9ff; border-radius: 16px; box-shadow: 0 2px 10px #0001; padding: 28px 22px; }
        .auth-box h2 { margin-bottom: 12px; color: #2575fc; }
        .auth-box input { width: 100%; margin-bottom: 12px; padding: 11px; border-radius: 7px; border: 1px solid #ccc; font-size: 1rem; }
        .auth-box button { width: 100%; padding: 13px; border-radius: 7px; border: none; background: #6a11cb; color: #fff; font-weight: 600; cursor: pointer; margin-bottom: 8px; }
        .auth-box button.secondary { background: #10b981; }
        .auth-error { color: #ef4444; font-size: 0.98rem; margin-bottom: 8px; }
        .account { text-align: right; margin-bottom: 12px; }
        .account span { margin-right: 14px; font-weight:600; color:#2575fc;}
        .account button { background: #ef4444; color:#fff; border:none; padding:6px 14px; border-radius:6px; cursor:pointer; }
        .set-controls { display: flex; gap: 14px; flex-wrap: wrap; margin-bottom: 18px; }
        .set-controls input, .set-controls select { padding: 9px; border-radius: 7px; border: 1px solid #ccc; }
        .set-controls button { padding: 9px 22px; border-radius: 7px; border: none; background: #6a11cb; color: #fff; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .set-controls button:hover { background: #2575fc; }
        textarea { width: 100%; height: 100px; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem; padding: 12px; margin-bottom: 10px; }
        .mode-controls { margin: 12px 0 14px 0; display: flex; gap:12px; }
        .mode-controls button { padding: 8px 20px; border-radius: 7px; border: none; background: #10b981; color: #fff; font-weight: 600; cursor: pointer; }
        .mode-controls button.active { background: #f59e0b; }
        .flashcard-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 20px; }
        .flashcard { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); color: #fff; border-radius: 12px; padding: 20px; font-weight: 600; text-align: center; cursor: pointer; height: 140px; display: flex; flex-direction: column; justify-content: center; transition: .4s; position: relative; }
        .flashcard.flipped { background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); }
        .flashcard .back { display: none; }
        .flashcard.flipped .front { display: none; }
        .flashcard.flipped .back { display: block; }
        .study-mode { background: #f8f9ff; padding: 18px 18px; border-radius: 14px; margin-bottom: 18px; }
        .study-front { font-weight: 600; font-size: 1.1rem; margin-bottom: 12px; }
        .study-input { width: 90%; padding: 9px; border-radius: 7px; border: 1px solid #ccc; font-size: 1.1rem; margin-bottom: 9px; }
        .study-check { background: #10b981; color: #fff; border: none; border-radius: 7px; padding: 9px 22px; font-weight: 600; cursor: pointer; }
        .study-result { margin-top: 7px; font-size: 1.08rem; }
        .study-next { margin-left: 12px; background: #6a11cb; color: #fff; }
        .set-list { margin-bottom: 12px; }
        @media (max-width: 700px) { .container { padding: 10px 2px; } .flashcard-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container" id="mainApp" style="display:none;">
        <div class="account" id="accountInfo">
            <span id="loggedUser"></span>
            <button id="logoutBtn">Logout</button>
        </div>
        <h1><i class="fas fa-clone"></i> Multi-Set Flashcard Generator</h1>
        <div class="set-controls">
            <input type="text" id="setNameInput" placeholder="New Set Name">
            <button id="createSetBtn"><i class="fas fa-plus"></i> Create Set</button>
            <select id="setsSelect"></select>
            <button id="switchSetBtn"><i class="fas fa-folder-open"></i> Switch Set</button>
            <button id="deleteSetBtn" style="background:#ff6b6b;">Delete Set</button>
            <button id="shuffleBtn" style="background:#f59e0b;"><i class="fas fa-random"></i> Shuffle</button>
        </div>
        <div class="set-list" id="setListInfo"></div>
        <textarea id="textInput" placeholder="Front of card | Back of card&#10;Enter each flashcard on a new line."></textarea>
        <button id="updateSetBtn" style="background:#10b981;margin-bottom:12px;"><i class="fas fa-save"></i> Update Set</button>
        <div class="mode-controls">
            <button id="modeCardBtn" class="active">Card Mode</button>
            <button id="modeStudyBtn">Study Mode</button>
        </div>
        <div id="flashcardContainer" class="flashcard-container"></div>
        <div id="studyModeSection" class="study-mode" style="display:none;"></div>
    </div>
    <div class="auth-box" id="authBox">
        <h2>Welcome to Flashcard App</h2>
        <div id="authError" class="auth-error"></div>
        <input type="text" id="authUsername" placeholder="Username" autocomplete="username">
        <input type="password" id="authPassword" placeholder="Password" autocomplete="current-password">
        <button id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
        <button id="registerBtn" class="secondary"><i class="fas fa-user-plus"></i> Register</button>
    </div>
    <script>
        // Simple hash for password (not secure, but better than plaintext)
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash |= 0; // Convert to 32bit integer
            }
            return hash.toString();
        }

        // User/account management
        function getAllUsers() {
            return JSON.parse(localStorage.getItem('flashcardUsers') || '{}');
        }
        function saveAllUsers(users) {
            localStorage.setItem('flashcardUsers', JSON.stringify(users));
        }

        let currentUser = null;
        let flashcardSets = {};
        let currentSetName = "";
        let currentMode = 'card'; // 'card' or 'study'
        let studyIndex = 0;
        let studyOrder = [];

        // Show/hide UI
        function showMainApp() {
            document.getElementById('authBox').style.display = 'none';
            document.getElementById('mainApp').style.display = '';
            document.getElementById('loggedUser').textContent = currentUser;
        }
        function showAuth() {
            document.getElementById('authBox').style.display = '';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('authError').textContent = '';
            document.getElementById('authUsername').value = '';
            document.getElementById('authPassword').value = '';
        }

        // Login/Register/Logout functions
        document.getElementById('loginBtn').onclick = function() {
            const username = document.getElementById('authUsername').value.trim();
            const password = document.getElementById('authPassword').value;
            if (!username || !password) {
                document.getElementById('authError').textContent = "Please enter username and password.";
                return;
            }
            const users = getAllUsers();
            if (!users[username]) {
                document.getElementById('authError').textContent = "Username not found.";
                return;
            }
            if (users[username].password !== simpleHash(password)) {
                document.getElementById('authError').textContent = "Incorrect password.";
                return;
            }
            currentUser = username;
            flashcardSets = users[username].sets || {};
            if (Object.keys(flashcardSets).length === 0) {
                flashcardSets["Default Set"] = [
                    {front:"Photosynthesis", back:"Plants convert sunlight into energy"},
                    {front:"Mitochondria", back:"Powerhouse of the cell"},
                    {front:"Newton's First Law", back:"Objects in motion stay in motion"},
                    {front:"GDP", back:"Total value of goods/services in a country"},
                    {front:"Renaissance", back:"Italian cultural movement, 14th century"},
                    {front:"HTML", back:"Markup language for web pages"}
                ];
            }
            currentSetName = Object.keys(flashcardSets)[0];
            studyIndex = 0;
            studyOrder = [];
            showMainApp();
            updateSetsSelect();
            document.getElementById('textInput').value = flashcardSets[currentSetName].map(c => `${c.front} | ${c.back}`).join('\n');
            renderFlashcards();
            renderStudyMode();
        };

        document.getElementById('registerBtn').onclick = function() {
            const username = document.getElementById('authUsername').value.trim();
            const password = document.getElementById('authPassword').value;
            if (!username || !password) {
                document.getElementById('authError').textContent = "Please enter username and password.";
                return;
            }
            const users = getAllUsers();
            if (users[username]) {
                document.getElementById('authError').textContent = "Username already exists.";
                return;
            }
            users[username] = {
                password: simpleHash(password),
                sets: {
                    "Default Set": [
                        {front:"Photosynthesis", back:"Plants convert sunlight into energy"},
                        {front:"Mitochondria", back:"Powerhouse of the cell"},
                        {front:"Newton's First Law", back:"Objects in motion stay in motion"},
                        {front:"GDP", back:"Total value of goods/services in a country"},
                        {front:"Renaissance", back:"Italian cultural movement, 14th century"},
                        {front:"HTML", back:"Markup language for web pages"}
                    ]
                }
            };
            saveAllUsers(users);
            document.getElementById('authError').textContent = "Account created! Please login.";
            // Optionally, auto-log in: currentUser = username; ...
        };

        document.getElementById('logoutBtn').onclick = function() {
            // Save sets before logout
            saveCurrentUserSets();
            currentUser = null;
            flashcardSets = {};
            currentSetName = "";
            studyIndex = 0;
            studyOrder = [];
            showAuth();
        };

        function saveCurrentUserSets() {
            if (currentUser) {
                const users = getAllUsers();
                users[currentUser].sets = flashcardSets;
                saveAllUsers(users);
            }
        }

        // Flashcard logic (just like before, but per user)
        function updateSetsSelect() {
            const select = document.getElementById('setsSelect');
            select.innerHTML = '';
            Object.keys(flashcardSets).forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                if (name === currentSetName) option.selected = true;
                select.appendChild(option);
            });
            document.getElementById('setListInfo').textContent = "Current Set: " + currentSetName + " (" + flashcardSets[currentSetName].length + " cards)";
        }

        function parseFlashcardsFromText(text) {
            const lines = text.split('\n');
            const flashcards = [];
            lines.forEach(line => {
                const parts = line.split('|');
                if (parts.length === 2) {
                    flashcards.push({
                        front: parts[0].trim(),
                        back: parts[1].trim()
                    });
                }
            });
            return flashcards;
        }

        function renderFlashcards() {
            const container = document.getElementById('flashcardContainer');
            container.innerHTML = '';
            if (currentMode !== 'card') { container.style.display = 'none'; return; }
            container.style.display = '';
            const cards = flashcardSets[currentSetName];
            if (!cards.length) {
                container.innerHTML = '<div style="color:#888;">No cards. Add some and click Update Set.</div>';
                return;
            }
            cards.forEach(card => {
                const div = document.createElement('div');
                div.className = 'flashcard';
                div.innerHTML = `<div class="front">${card.front}</div><div class="back">${card.back}</div>`;
                div.onclick = function(){ this.classList.toggle('flipped'); };
                container.appendChild(div);
            });
        }

        function renderStudyMode() {
            const section = document.getElementById('studyModeSection');
            section.innerHTML = '';
            if (currentMode !== 'study') { section.style.display = 'none'; return; }
            section.style.display = 'block';
            const cards = flashcardSets[currentSetName];
            if (!cards.length) { section.innerHTML = '<div>No cards to study.</div>'; return; }
            if (!studyOrder.length || studyOrder.length !== cards.length) {
                studyOrder = Array.from({length: cards.length}, (_, i) => i);
            }
            const card = cards[studyOrder[studyIndex]];
            section.innerHTML = `
                <div class="study-front">Front: ${card.front}</div>
                <input type="text" class="study-input" id="studyInput" autocomplete="off" placeholder="Type the back answer here">
                <button class="study-check" id="studyCheckBtn">Check</button>
                <button class="study-next" id="studyNextBtn">Next</button>
                <div class="study-result" id="studyResult"></div>
                <div style="margin-top:7px;color:#888;">Card ${studyIndex+1} of ${cards.length}</div>
            `;
            document.getElementById('studyCheckBtn').onclick = function() {
                const userAns = document.getElementById('studyInput').value.trim();
                const correctAns = card.back.trim();
                const resultDiv = document.getElementById('studyResult');
                if (userAns.toLowerCase() === correctAns.toLowerCase()) {
                    resultDiv.innerHTML = "<span style='color:#10b981;font-weight:bold;'>Correct!</span>";
                } else {
                    resultDiv.innerHTML = "<span style='color:#ef4444;font-weight:bold;'>Incorrect.</span> <br>Correct answer: <b>" + correctAns + "</b>";
                }
            };
            document.getElementById('studyNextBtn').onclick = function() {
                studyIndex = (studyIndex + 1) % cards.length;
                renderStudyMode();
            };
            document.getElementById('studyInput').onkeypress = function(e) {
                if (e.key === "Enter") document.getElementById('studyCheckBtn').click();
            };
        }

        // Shuffle function - Fisher-Yates algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Controls
        document.getElementById('createSetBtn').onclick = function() {
            const name = document.getElementById('setNameInput').value.trim();
            if (!name) return alert("Enter set name!");
            if (flashcardSets[name]) return alert("Set name exists!");
            flashcardSets[name] = [];
            currentSetName = name;
            saveCurrentUserSets();
            updateSetsSelect();
            document.getElementById('textInput').value = "";
            studyIndex = 0;
            studyOrder = [];
            renderFlashcards();
            renderStudyMode();
        };

        document.getElementById('switchSetBtn').onclick = function() {
            const select = document.getElementById('setsSelect');
            currentSetName = select.value;
            document.getElementById('textInput').value = flashcardSets[currentSetName].map(c => `${c.front} | ${c.back}`).join('\n');
            studyIndex = 0;
            studyOrder = [];
            saveCurrentUserSets();
            updateSetsSelect();
            renderFlashcards();
            renderStudyMode();
        };

        document.getElementById('deleteSetBtn').onclick = function() {
            if (Object.keys(flashcardSets).length === 1) return alert("Cannot delete the last set.");
            if (confirm("Delete set '" + currentSetName + "'?")) {
                delete flashcardSets[currentSetName];
                currentSetName = Object.keys(flashcardSets)[0];
                saveCurrentUserSets();
                updateSetsSelect();
                document.getElementById('textInput').value = flashcardSets[currentSetName].map(c => `${c.front} | ${c.back}`).join('\n');
                studyIndex = 0;
                studyOrder = [];
                renderFlashcards();
                renderStudyMode();
            }
        };

        document.getElementById('updateSetBtn').onclick = function() {
            flashcardSets[currentSetName] = parseFlashcardsFromText(document.getElementById('textInput').value);
            studyIndex = 0;
            studyOrder = [];
            saveCurrentUserSets();
            updateSetsSelect();
            renderFlashcards();
            renderStudyMode();
        };

        document.getElementById('shuffleBtn').onclick = function() {
            const currentSet = flashcardSets[currentSetName];
            if (currentSet.length === 0) return;
            shuffleArray(currentSet);
            studyOrder = Array.from({length: currentSet.length}, (_, i) => i);
            studyIndex = 0;
            document.getElementById('textInput').value = currentSet.map(c => `${c.front} | ${c.back}`).join('\n');
            saveCurrentUserSets();
            renderFlashcards();
            renderStudyMode();
        };

        document.getElementById('modeCardBtn').onclick = function() {
            currentMode = 'card';
            this.classList.add('active');
            document.getElementById('modeStudyBtn').classList.remove('active');
            renderFlashcards();
            renderStudyMode();
        };

        document.getElementById('modeStudyBtn').onclick = function() {
            currentMode = 'study';
            this.classList.add('active');
            document.getElementById('modeCardBtn').classList.remove('active');
            renderFlashcards();
            renderStudyMode();
        };

        // Initial UI
        showAuth();
    </script>
</body>
</html>
